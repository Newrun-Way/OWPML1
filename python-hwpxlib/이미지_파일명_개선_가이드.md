# 이미지 파일명 개선 가이드

## 개요

기존 extract.py는 이미지를 `image.01`, `image.02` 같은 일반적인 이름으로 저장했습니다.
`extract_v2.py`는 **문맥을 분석하여 의미 있는 파일명**을 자동으로 생성합니다.

## 사용 방법

### 기본 사용
```bash
cd python-hwpxlib
python extract_v2.py "문서파일.hwpx"
```

### 예시
```bash
python extract_v2.py "교통안전현황분석 리포트.hwpx"
```

## 파일명 생성 규칙

### 1. 캡션이 있는 경우 (최우선)
```
[문서명]_[캡션]_img01.jpg
```
예: `교통안전_사고발생현황_img01.jpg`

### 2. 표 안의 이미지인 경우
```
[문서명]_표_[표제목]_img01.jpg
```
예: `교통안전_표_연도별_통계_img01.jpg`

### 3. 주변 텍스트가 있는 경우
```
[문서명]_[주변텍스트]_img01.jpg
```
예: `교통안전_사고유형_분석결과_img01.jpg`

### 4. 문맥 정보가 없는 경우
```
[문서명]_img01.jpg
```
예: `교통안전_img01.jpg`

## 개선 사항

### Before (extract.py)
```
extracted_교통안전/
├── image.01
├── image.02
├── image.03
```

문제점:
- 어떤 이미지인지 알 수 없음
- 파일명만으로 내용 파악 불가
- 관리 및 검색 어려움

### After (extract_v2.py)
```
extracted_교통안전/
├── 교통안전_사고발생현황_img01.jpg
├── 교통안전_표_연도별_통계_img02.png
├── 교통안전_사고유형_분석결과_img03.jpg
```

장점:
- 파일명만으로 내용 파악 가능
- 검색 용이
- RAG 시스템에서 활용 가능

## 생성된 파일 구조

```
extracted_문서명/
├── 문서명_전체텍스트.txt
├── 문서명_표데이터.json
├── 문서명_표목록.txt
├── 문서명_구조.json           [이미지 메타데이터 포함]
├── 문서명_추출요약.txt         [이미지 캡션 정보 포함]
├── 문서명_캡션내용_img01.jpg
├── 문서명_표_제목_img02.png
└── ...
```

## 구조.json에 포함된 이미지 메타데이터

```json
{
  "images_info": [
    {
      "filename": "교통안전_사고발생현황_img01.jpg",
      "original_filename": "image.01",
      "size": 125486,
      "context": {
        "caption": "그림 1. 최근 5년간 사고 발생 현황",
        "parent_type": ""
      }
    },
    {
      "filename": "교통안전_표_연도별_통계_img02.png",
      "original_filename": "image.02",
      "size": 89234,
      "context": {
        "caption": "",
        "parent_type": "table"
      }
    }
  ]
}
```

## 파일명 안전 처리

### 자동 처리 내용
- Windows 금지 문자 제거: `\ / : * ? " < > |`
- 공백 → 언더스코어 변환
- 최대 길이 제한 (문서명 20자 + 캡션 30자 + 번호)
- 중복 방지 (순차 번호 추가)

### 예시
```
원본 캡션: "그림 1. 2020~2024년 교통사고 발생 현황 (단위: 건)"
→ 파일명: "교통안전_그림_1_2020_2024년_교통사고_발생_현황_단위_건_img01.jpg"
```

## 기존 extract.py와 비교

| 특징 | extract.py | extract_v2.py |
|------|-----------|---------------|
| 이미지 파일명 | image.01 | 교통안전_사고현황_img01.jpg |
| 캡션 인식 | 없음 | 자동 인식 |
| 문맥 분석 | 없음 | 주변 텍스트 분석 |
| 표 이미지 구분 | 없음 | 자동 구분 |
| 메타데이터 | 기본 정보만 | 캡션, 문맥 포함 |
| RAG 활용 | 제한적 | 최적화 |

## 테스트 방법

### 1. 샘플 문서로 테스트
```bash
python extract_v2.py "hwp data/교통안전현황분석 리포트.hwpx"
```

### 2. 결과 확인
```bash
cd extracted_교통안전현황분석_리포트
dir  # Windows
ls   # Linux/Mac
```

### 3. 구조.json 확인
```bash
cat extracted_교통안전현황분석_리포트/교통안전현황분석_리포트_구조.json
```

## 주의사항

1. **HWPX 파일만 지원**
   - HWP 파일은 이미지 추출 안 됨
   - HWPX로 저장 후 사용

2. **캡션이 없으면**
   - 주변 텍스트 사용
   - 그것도 없으면 문서명 + 순번 사용

3. **긴 파일명**
   - 자동으로 50자 이내로 축약
   - 중요한 정보 우선 유지

## 다음 단계: RAG 시스템 통합

개선된 이미지 파일명으로 다음이 가능합니다:

1. **이미지 검색**
   ```python
   # 파일명으로 내용 추측 가능
   "교통안전_사고발생현황_img01.jpg"
   ```

2. **메타데이터 활용**
   ```python
   # 구조.json에서 캡션 정보 활용
   image_caption = "그림 1. 최근 5년간 사고 발생 현황"
   ```

3. **이미지 + 텍스트 통합**
   ```python
   # 이미지 캡션을 텍스트로 추가
   context = f"{text_content}\n\n[이미지: {image_caption}]"
   ```

## 문의 및 개선

추가 개선 사항:
- OCR로 이미지 내 텍스트 추출
- AI로 이미지 내용 자동 설명 생성
- 다국어 캡션 지원

